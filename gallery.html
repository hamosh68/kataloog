<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>معرض صور المنتجات - IBC</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/glightbox/3.2.0/css/glightbox.min.css" />
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: #f5f5f5; }
        
        .header {
            background: linear-gradient(135deg, #1a237e, #3949ab);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .header-title { display: flex; align-items: center; gap: 10px; }
        .header-title i { font-size: 1.8rem; }
        
        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 50px;
            padding: 8px 20px;
            cursor: pointer;
            font-family: 'Cairo';
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .back-btn:hover { background: rgba(255,255,255,0.3); transform: translateX(5px); }
        
        .search-section { max-width: 800px; margin: 20px auto; padding: 0 20px; }
        
        .search-box {
            display: flex;
            background: white;
            border-radius: 50px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            position: relative;
        }
        
        .search-box input { flex: 1; padding: 15px 20px; border: none; outline: none; font-size: 1rem; }
        .search-box button { padding: 0 25px; background: #1a237e; color: white; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .search-box button:hover { background: #3949ab; }
        
        .clear-search-btn {
            position: absolute; left: 120px; top: 50%; transform: translateY(-50%);
            background: #f44336; color: white; border: none; border-radius: 50%;
            width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 1.2rem; transition: 0.3s; z-index: 10;
        }

        /* كارت الإحصائيات المطور */
        .brand-stats-card {
            background: white; border-radius: 12px; padding: 15px; margin: 15px auto;
            max-width: 550px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-right: 5px solid #FF9800; text-align: center;
        }
        
        .brand-stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 10px 0; }
        .brand-stat-item { background: #f8f9fa; border-radius: 8px; padding: 10px 5px; }
        .brand-stat-value { font-size: 1.3rem; font-weight: bold; display: block; }
        .brand-stat-label { font-size: 0.75rem; color: #666; }

        .btn-missing-report {
            background: #f44336; color: white; border: none; padding: 5px 15px;
            border-radius: 20px; font-size: 0.8rem; cursor: pointer; margin-top: 10px;
            font-family: 'Cairo'; display: none;
        }

        .gallery-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        
        .product-card {
            background: white; border-radius: 15px; overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: 0.3s;
            border: 1px solid #eee; animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .product-image { width: 100%; height: 200px; object-fit: contain; padding: 15px; background: #fff; }
        .product-info { padding: 15px; }
        .product-brand { font-size: 0.8rem; font-weight: bold; color: #1a237e; background: #e8eaf6; padding: 3px 10px; border-radius: 12px; }
        .product-name { font-weight: bold; font-size: 1.05rem; margin: 10px 0; height: 2.6em; overflow: hidden; }
        
        .price-tag { background: #4CAF50; color: white; padding: 8px; border-radius: 10px; text-align: center; font-weight: bold; margin-top: 10px; }
        .missing-tag { font-size: 0.7rem; color: #f44336; font-weight: bold; display: block; margin-top: 5px; }

        .scroll-top-btn {
            position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px;
            background: #1a237e; color: white; border: none; border-radius: 50%;
            display: none; align-items: center; justify-content: center; cursor: pointer; z-index: 1000;
        }
    </style>
</head>
<body>

<div class="header">
    <div class="header-title">
        <i class="fas fa-images"></i>
        <h1>معرض أصناف IBC</h1>
    </div>
    <a href="index.html" class="back-btn"><i class="fas fa-arrow-right"></i> العودة</a>
</div>

<div class="search-section">
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="ابحث بالاسم، الكود، الباركود...">
        <button class="clear-search-btn" id="clearSearchBtn" onclick="clearSearch()" style="display: none;">✕</button>
        <button onclick="searchProducts()"><i class="fas fa-search"></i> بحث</button>
    </div>
</div>

<div id="currentBrandStats"></div>

<div class="search-section" style="display: flex; gap: 10px; align-items: center; justify-content: space-between;">
    <select id="brandSelect" style="padding: 10px 20px; border-radius: 25px; border: 2px solid #ddd; font-family: 'Cairo'; flex: 1;"></select>
    <div id="currentBrandBadge"></div>
</div>

<div class="gallery-container">
    <div class="gallery-grid" id="galleryGrid"></div>
    <div class="load-more-container" id="loadMoreContainer" style="text-align: center; display: none;">
        <button class="load-more-btn" onclick="loadMoreProducts()" id="loadMoreBtn" style="padding: 12px 30px; background: #1a237e; color: white; border-radius: 50px; border: none; cursor: pointer;">
            عرض المزيد
        </button>
    </div>
</div>

<button class="scroll-top-btn" id="scrollTopBtn" onclick="window.scrollTo({top:0, behavior:'smooth'})"><i class="fas fa-arrow-up"></i></button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/glightbox/3.2.0/js/glightbox.min.js"></script>
<script src="products-data.js"></script>
<script>
    (function() {
        "use strict";
        const SUPPORTED_EXTENSIONS = ['webp', 'png', 'jpg'];
        const ITEMS_PER_PAGE = 40;
        let allProducts = typeof products !== 'undefined' ? products : [];
        let filteredProducts = [];
        let currentBrand = "Stabilo";
        let currentPage = 1;
        let isLoading = false;
        let lightbox = null;
        let missingImagesList = [];

        // التحقق من الصورة
        function checkImage(url) {
            return new Promise(resolve => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url;
            });
        }

        // بناء الإحصائيات للماركة الحالية
        async function updateStats(brand) {
            const container = document.getElementById('currentBrandStats');
            const targetProducts = brand === "الكل" ? allProducts : allProducts.filter(p => p.brand === brand);
            
            let hasImg = 0;
            missingImagesList = [];

            for (const p of targetProducts) {
                const exists = await checkImage(`images/${p.code}.webp`);
                if (exists) hasImg++; else missingImagesList.push(p.code);
            }

            const total = targetProducts.length;
            const percent = Math.round((hasImg / total) * 100);

            container.innerHTML = `
                <div class="brand-stats-card">
                    <div class="brand-stats-title"><b>إحصائية ${brand}</b></div>
                    <div class="brand-stats-grid">
                        <div class="brand-stat-item"><span class="brand-stat-value">${total}</span><span class="brand-stat-label">صنف</span></div>
                        <div class="brand-stat-item"><span class="brand-stat-value" style="color:#4CAF50">${hasImg}</span><span class="brand-stat-label">صور</span></div>
                        <div class="brand-stat-item"><span class="brand-stat-value" style="color:#f44336">${total - hasImg}</span><span class="brand-stat-label">نقص</span></div>
                    </div>
                    <div style="font-size: 0.9rem; font-weight: bold; color: #4CAF50; margin-top: 5px;">نسبة الإكمال: ${percent}%</div>
                    <button class="btn-missing-report" id="btnShowMissing" style="${missingImagesList.length > 0 ? 'display:inline-block' : 'none'}" onclick="alert('الأكواد الناقصة صورها:\\n\\n' + window.missingList.join('\\n'))">عرض الأكواد الناقصة</button>
                </div>
            `;
            window.missingList = missingImagesList;
        }

        async function displayProducts(reset = true) {
            if (isLoading) return;
            isLoading = true;
            const grid = document.getElementById('galleryGrid');
            if (reset) { grid.innerHTML = ''; currentPage = 1; }

            const end = currentPage * ITEMS_PER_PAGE;
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const slice = filteredProducts.slice(startIndex, end);

            let html = '';
            for (const p of slice) {
                const imgUrl = `images/${p.code}.webp`;
                const exists = await checkImage(imgUrl);
                
                html += `
                    <div class="product-card">
                        <a href="${exists ? imgUrl : 'images/default-product.webp'}" class="glightbox" data-title="${p.name}">
                            <img src="${exists ? imgUrl : 'images/default-product.webp'}" class="product-image" loading="lazy">
                        </a>
                        <div class="product-info">
                            <span class="product-brand">${p.brand}</span>
                            <div class="product-name">${p.name}</div>
                            <div class="product-details" style="background:#f9f9f9; padding:10px; border-radius:8px; font-size:0.85rem;">
                                <div style="display:flex; justify-content:space-between;"><span>كود:</span> <b>${p.code}</b></div>
                                <div style="display:flex; justify-content:space-between;"><span>باركود:</span> <b>${p.barcode || '-'}</b></div>
                                <div style="display:flex; justify-content:space-between;"><span>القسم:</span> <b>${p.sub || '-'}</b></div>
                            </div>
                            <div class="price-tag">${p.price || '0.00'} د.ك</div>
                            ${!exists ? '<span class="missing-tag">⚠️ الصورة غير متوفرة</span>' : ''}
                        </div>
                    </div>`;
            }

            grid.insertAdjacentHTML('beforeend', html);
            document.getElementById('loadMoreContainer').style.display = filteredProducts.length > end ? 'block' : 'none';
            
            if (lightbox) lightbox.reload();
            else lightbox = GLightbox({ selector: '.glightbox' });
            isLoading = false;
        }

        window.searchProducts = function() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            filteredProducts = allProducts.filter(p => 
                p.name.toLowerCase().includes(query) || p.code.toLowerCase().includes(query) || (p.barcode && p.barcode.includes(query))
            );
            document.getElementById('clearSearchBtn').style.display = query ? 'flex' : 'none';
            updateStats("النتائج");
            displayProducts(true);
        };

        window.loadMoreProducts = function() { currentPage++; displayProducts(false); };
        window.clearSearch = function() { document.getElementById('searchInput').value = ''; searchProducts(); };

        // القائمة والترتيب
        const brands = ["Stabilo", ...new Set(allProducts.map(p => p.brand).filter(b => b !== "Stabilo"))].sort();
        const select = document.getElementById('brandSelect');
        select.innerHTML = brands.map(b => `<option value="${b}">${b}</option>`).join('') + '<option value="الكل">الكل</option>';
        
        select.addEventListener('change', function() {
            currentBrand = this.value;
            filteredProducts = currentBrand === "الكل" ? allProducts : allProducts.filter(p => p.brand === currentBrand);
            updateStats(currentBrand);
            displayProducts(true);
        });

        // التشغيل الأولي
        select.value = "Stabilo";
        filteredProducts = allProducts.filter(p => p.brand === "Stabilo");
        updateStats("Stabilo");
        displayProducts(true);

        window.addEventListener('scroll', () => {
            document.getElementById('scrollTopBtn').style.display = window.scrollY > 400 ? 'flex' : 'none';
        });

    })();
</script>
</body>
</html>







